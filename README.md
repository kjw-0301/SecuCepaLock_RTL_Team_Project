# 스마트 금고설계(RTL Project)
### 💻개발배경
**RFID기능으로 동작하는 금고를 설계하고자 계획했습니다. 등록된 카드만 금고의 문을 열 수 있으며, 내부에는 2중으로 키패드로 비밀번호를 입력하는 2중 보안 시스템을 갖춘 금고를 설계하고자 계획했습니다.**
#### #📌 SPI통신으로 주어진 RC522로 RFID기능을 구현하려 했습니다. 처음 저희 팀의 목표는 배우지 않은 내용인 SPI통신과 사용해보지 않은 RC522의 데이터시트를 분석하여 RC522의 모듈을 설계하고자 했으나, 주어진 프로젝트 기간이 짧았던 점, 도전하고자 했던 RC522의 데이터시트 분석이 생각보다 난이도가 높았고 시간이 오래걸려 RFID 기능은 미완성으로 프로젝트를 마무리했습니다. 하지만 추후에 Verilog언어로 RC522의 SPI통신 프로토콜을 설계한 모듈을 팀원들과 분석하여 미완성인 프로젝트를 완성시키도록 계획하고 있습니다.  
## 기능설명
1.  초기상태에서 LCD에는 “Enter Password”를 출력하고, open 버튼을 누르면 0번 LED ON 됩니다.
2.  비밀번호가 맞게 입력하면 1번 LED ON, LCD는“OPEN”상태의 메시지를 표시하고 금고의 문이 열립니다.
3. 금고가 open인 상황에서 금고 문을 닫고 사용자가 멀어진다면 자동으로 문의 잠금 장치가 잠기게됩니다.
4. 만약, 틀린 비밀번호를 입력하게 된다면 LCD는 “ERROR”상태의 메시지를 표시합니다.
5.  “ERROR”상태에서 OPEN버튼을 누르면 다시 비밀번호 입력모드로 되돌아갑니다.
## 상세 코드 설명
- 하나의 모듈로 설계하였습니다. gitHub 레포지토리의 바로 보이는`Safety_Box.v`으로 확인해보실 수 있습니다.
- 키패드가 눌리는 순간 `EDGE_DETECTOR` 모듈에서 상승엣지, 하강엣지를 잡아서 버튼이 눌리는, 즉 비밀번호를 입력했을때를 `key_valid_p`로 받아서 탑 모듈의 `FSM(유한 상태머신)`을 제어하도록 설계하였습니다.
- 비밀번호를 하나씩 입력하는 순간을 각각의 `State`로 만들어서 각각의 `State`마다 맞는`key_value`, 즉 비밀번호가 입력이되면 다음 `State`로 이동합니다. 만약 중간에 비밀번호가 틀리다면, `ERROR`에 `1`이 할당됩니다. 비밀번호를 틀리지않고 입력을 한다면 `open`에 `1`이 할당됩니다.
-  `I2C_txtLCD_top` LCD 모듈은 `SUB_CODE.v`에 있습니다. 초기 화면을 세팅하기 위해서는 LCD를 초기화 시켜줍니다. 이 초기화 작업은 `Flag`라는 `reg`로 선언하여 딱 한번만 초기화 작업이 진행되도록 합니다. 이후 `IDLE`상태에서 키패드가 입력되거나, `open`, `error`의 값이 할당되는 것을 기다립니다. 만약 키패드의 입력 `key_valid`의 상승엣지가 발생하면, `SEND_PASSWARD` 상태가 되면서, 발생하는 `key_valid`의 상승엣지 하나 당 별(*)표시 한개가 LCD에 입력됩니다. 또한 `open`이 되면 `SEND_ENTER` 상태가 되면서 LCD에는 "Welcome!!" 이라는 문구가 출력됩니다. 비밀번호를 틀려`error`의 값이 `1` 이 된다면 `SEND_ERROR` 상태가 되면서 LCD에는 비밀번호가 틀렸다는 메시지를 출력합니다.
- 또한 금고의 문일 열렸을 때 `HC_SR04_cntr`에서 받은 거리 값을`distance_bcd`라는 `wire`에 연결하였습니다. 이 거리 값이 만약 `30cm`보다 크다면 즉, 금고 앞에 사람이 없다면 금고의 문이 닫힙니다. 이는 금고 문을 닫고 자동으로 금고 문이 닫히도록 설계하였습니다. 
- 저희는 금고의 비밀번호를 확실히 아는 금고의 주인과 그 비밀번호를 확실하게 아는 사람만이 금고의 문을 열 수 있도록 설계하였습니다. 만약 비밀번호를 입력하다가 비밀번호 입력 제한시간(10초)를 넘기게 되면 다시 초기화면으로 넘어가도록 설계하였습니다.
